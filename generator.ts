import dotenv from "dotenv";
import StaticMap from "@mapbox/mapbox-sdk/services/static";

dotenv.config();

function generateMap(accessToken: string | undefined): string {
  if (!accessToken) {
    throw new Error("Access token is required");
  }

  const staticMapClient = StaticMap({ accessToken });

  const request = staticMapClient.getStaticImage({
    ownerId: "mapbox",
    styleId: "streets-v11",
    width: 375,
    height: 210,
    position: {
      coordinates: [14.428, 50.089],
      zoom: 12,
    },
    overlays: [
      // {
      //   marker: {
      //     coordinates: [14.419786306657654, 50.08604838837937],
      //     size: "small",
      //     color: "#ff0000",
      //   },
      // },
      {
        geoJson: {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [14.421195462349488, 50.09793913023016],
                [14.419841500497464, 50.09789645389761],
                [14.418500585215773, 50.09776883612321],
                [14.41718563715312, 50.09755750660754],
                [14.415909326338262, 50.097264501660135],
                [14.414683949916169, 50.09689264454666],
                [14.413521313505445, 50.096445518242845],
                [14.412432617327985, 50.09592743085983],
                [14.411428348214132, 50.09534337407611],
                [14.410518178528495, 50.09469897497982],
                [14.40971087299283, 50.0940004417884],
                [14.409014204304448, 50.09325450397148],
                [14.408434878361609, 50.092468347357354],
                [14.407978469813003, 50.09164954485122],
                [14.40764936854692, 50.09080598343523],
                [14.40745073762865, 50.089945788156186],
                [14.407384483082978, 50.089077243835185],
                [14.407451235803348, 50.08820871525442],
                [14.407650345751744, 50.08734856659123],
                [14.40797988849452, 50.08650508087527],
                [14.408436684000694, 50.08568638024425],
                [14.409016327511411, 50.084900347765306],
                [14.409713232174024, 50.08415455157319],
                [14.41052068302191, 50.083456172053644],
                [14.4114309017735, 50.082811932770774],
                [14.412435121821444, 50.082228035800455],
                [14.413523672686718, 50.08171010208933],
                [14.414686073123237, 50.081263117410344],
                [14.415911131977467, 50.08089138443204],
                [14.417187055834747, 50.08059848135976],
                [14.418501562420676, 50.08038722754414],
                [14.419841998672206, 50.080259656385586],
                [14.421195462349488, 50.08021699579329],
                [14.42254892602677, 50.080259656385586],
                [14.4238893622783, 50.08038722754414],
                [14.42520386886423, 50.08059848135976],
                [14.42647979272151, 50.08089138443204],
                [14.427704851575736, 50.081263117410344],
                [14.428867252012255, 50.08171010208933],
                [14.429955802877533, 50.082228035800455],
                [14.430960022925477, 50.082811932770774],
                [14.431870241677068, 50.083456172053644],
                [14.432677692524953, 50.08415455157319],
                [14.433374597187566, 50.084900347765306],
                [14.433954240698283, 50.08568638024425],
                [14.434411036204457, 50.08650508087527],
                [14.434740578947233, 50.08734856659123],
                [14.434939688895629, 50.08820871525442],
                [14.435006441615997, 50.089077243835185],
                [14.434940187070326, 50.089945788156186],
                [14.434741556152055, 50.09080598343523],
                [14.434412454885974, 50.09164954485122],
                [14.433956046337366, 50.092468347357354],
                [14.433376720394529, 50.09325450397148],
                [14.432680051706145, 50.0940004417884],
                [14.431872746170482, 50.09469897497982],
                [14.430962576484845, 50.09534337407611],
                [14.42995830737099, 50.09592743085983],
                [14.428869611193532, 50.096445518242845],
                [14.427706974782808, 50.09689264454666],
                [14.426481598360713, 50.097264501660135],
                [14.425205287545857, 50.09755750660754],
                [14.423890339483204, 50.09776883612321],
                [14.422549424201513, 50.09789645389761],
                [14.421195462349488, 50.09793913023016],
              ],
            ],
          },
        },
      },
    ],
  });

  return request.url();
}

console.log(generateMap(process.env.ACCESS_TOKEN));
